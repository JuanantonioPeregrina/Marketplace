<%- include('partials/header', {}) -%>
<body data-user-logged="<%= user ? 'true' : 'false' %>" data-username="<%= user?.username || '' %>">
  <link rel="stylesheet" href="/css/styleC.css">

  <div id="user-list">
      <h3>Usuarios Conectados</h3>
      <select id="target-user">
          <option value="">Todos</option>
      </select>
  </div>

  <div id="chat-container">
      <h1>Chat de Soporte</h1>

      <!-- Aviso para invitados -->
      <% if (!user) { %>
          <p class="chat-warning">Debes iniciar sesión para poder enviar mensajes.</p>
      <% } %>

      <!-- Lista de mensajes única -->
      <ul id="messages"></ul>

      <!-- Formulario de chat (bloqueado si es invitado) -->
      <form id="chat-form">
          <input id="message-input" type="text" placeholder="Escribe tu mensaje..." required <% if (!user) { %> disabled <% } %> />
          <button type="submit" id="submit-btn" <% if (!user) { %> disabled class="btn-disabled" <% } %>>Enviar</button>
      </form>
  </div>

  <div id="guest-list">
      <h3>Invitados Activos</h3>
      <ul id="active-guests"></ul>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script src="/js/soporte.js"></script> 

  <style>
    .chat-warning {
        color: red;
        font-size: 14px;
        text-align: center;
        margin-bottom: 10px;
    }

    input:disabled, button:disabled {
        background-color: #ccc;
        cursor: not-allowed;
    }

    .btn-disabled {
        pointer-events: none;
        cursor: not-allowed;
    }

    /* Estilos para los mensajes */
    #messages li.self {
        text-align: right;
        color: #007bff;
        margin-bottom: 5px;
    }

    #messages li.other {
        text-align: left;
        color: #333;
        margin-bottom: 5px;
    }

    #messages li.system {
        text-align: center;
        font-style: italic;
        color: #666;
        margin-bottom: 5px;
    }
  </style>

<%- include('partials/footer') %>
</body>

