<%- include("partials/header") %>

<main class="container mx-auto px-4 py-6">
    <h1 class="text-3xl font-bold text-center mb-6">Anuncios Publicados</h1>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        <% anuncios.forEach(anuncio => { %>
            <div class="bg-white p-4 rounded-lg shadow-lg">
                <img src="<%= anuncio.imagen %>" alt="Imagen de <%= anuncio.titulo %>" class="anuncio-imagen">
                <h2 class="text-xl font-semibold mt-2"><%= anuncio.titulo %></h2>
                <p class="text-gray-700"><%= anuncio.descripcion %></p>
                <p class="text-green-600 font-bold mt-2">€<%= anuncio.precio %></p>
                
                <p class="text-sm text-gray-500 mt-2">Publicado por: <strong><%= anuncio.autor %></strong></p>

                <!-- 🔹 ESTA LÍNEA SE AGREGA AQUÍ -->
                <p class="text-sm text-red-500 mt-2" id="expira-<%= anuncio._id %>"></p>

                <!-- 🔎 Debugging: Mostrar usuario autenticado y autor del anuncio -->
                <p class="text-sm text-blue-500">Usuario autenticado: <%= user ? user.username : "No definido" %></p>
                <p class="text-sm text-blue-500">Autor del anuncio: <%= anuncio.autor %></p>

                <!-- Lista de inscritos con botón para iniciar conversación -->
                <% if (user && user.username === anuncio.autor) { %>
                    <h4 class="text-md font-semibold mt-4">Usuarios inscritos:</h4>
                    <ul id="inscritos-<%= anuncio._id %>" class="mt-2 space-y-2">
                        <% if (anuncio.inscritos.length > 0) { %>
                            <% anuncio.inscritos.forEach(inscrito => { %>
                                <li class="text-sm text-gray-700 flex justify-between items-center">
                                    <span><%= inscrito %></span>
                                    <button onclick="iniciarChat('<%= anuncio._id %>', '<%= inscrito %>')" 
                                        class="bg-blue-500 text-white px-2 py-1 rounded text-xs border border-red-500 block">
                                        💬 Comenzar conversación
                                    </button>
                                </li>
                            <% }); %>
                        <% } else { %>
                            <p class="text-gray-500">No hay usuarios inscritos todavía.</p>
                        <% } %>
                    </ul>
                <% } %>

            </div>
        <% }); %>
    </div>
</main>

<%- include("partials/footer") %>

