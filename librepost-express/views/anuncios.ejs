<%- include("partials/header") %>

<main class="container mx-auto px-4 py-6">
    <h1 class="text-3xl font-bold text-center mb-6">Anuncios Publicados</h1>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        <% anuncios.forEach(anuncio => { %>
            <div class="bg-white p-4 rounded-lg shadow-lg">
                <img src="<%= anuncio.imagen %>" alt="Imagen de <%= anuncio.titulo %>" class="anuncio-imagen">
                <h2 class="text-xl font-semibold mt-2"><%= anuncio.titulo %></h2>
                <p class="text-gray-700"><%= anuncio.descripcion %></p>
                <p class="text-green-600 font-bold mt-2">‚Ç¨<%= anuncio.precio %></p>

                <p class="text-sm text-gray-500 mt-2">Publicado por: <strong><%= anuncio.autor %></strong></p>

                <p class="text-sm text-blue-500">Usuario autenticado: <%= user ? user.username : "No definido" %></p>
                <p class="text-sm text-blue-500">Autor del anuncio: <%= anuncio.autor %></p>

                <!-- üîπ Mostrar el chat correctamente -->
                <% if (user && user.username !== anuncio.autor && anuncio.inscritos.includes(user.username)) { %>
                    <% if (anuncio.chatIniciado) { %>
                        <a href="/chat?anuncioId=<%= anuncio._id %>&usuario=<%= anuncio.autor %>" 
                            class="bg-green-500 text-white px-3 py-2 rounded-lg shadow-md block text-center mt-2">
                            üí¨ Ir al chat
                        </a>
                    <% } else { %>
                        <button class="bg-gray-400 text-white px-3 py-2 rounded-lg shadow-md opacity-50 cursor-not-allowed block text-center mt-2" disabled>
                            ‚è≥ Esperando conversaci√≥n
                        </button>
                    <% } %>
                <% } %>

               <!-- Lista de inscritos con bocadillo clickeable -->
                <% if (user && user.username === anuncio.autor) { %>
                    <h4 class="text-md font-semibold mt-4">Usuarios inscritos:</h4>
                    <ul id="inscritos-<%= anuncio._id %>" class="mt-2 space-y-2">
                        <% if (anuncio.inscritos.length > 0) { %>
                            <% anuncio.inscritos.forEach(inscrito => { %>
                                <li class="text-sm text-gray-700 flex justify-between items-center">
                                    <a href="/chat?anuncioId=<%= anuncio._id %>&usuario=<%= inscrito %>" 
                                       class="text-blue-500 hover:underline flex items-center">
                                        <span><%= inscrito %></span>
                                        <span class="ml-2">üí¨</span> <!-- Bocadillo clickeable -->
                                    </a>
                                </li>
                            <% }); %>
                        <% } else { %>
                            <p class="text-gray-500">No hay usuarios inscritos todav√≠a.</p>
                        <% } %>
                    </ul>
                <% } %>

            </div>
        <% }); %>
    </div>
</main>

<%- include("partials/footer") %>



